  CC = gcc 

  
  128SL_CFLAGS = -DCATEGORY=1
  192SL_CFLAGS = -DCATEGORY=3
  256SL_CFLAGS = -DCATEGORY=5
  
  N02_CFLAGS = -DN0=2
  N03_CFLAGS = -DN0=3
  N04_CFLAGS = -DN0=4
  
  DFR_64_CFLAGS = -DDFR_SL_LEVEL=0
  DFR_SL_CFLAGS = -DDFR_SL_LEVEL=1
  
  REFERENCE_IMPL_PATH = ../../../Optimized_Implementation/KEM-LT

  CFLAGS = -DCPU_WORD_BITS=64 -std=c11 -Wall -pedantic -Wmaybe-uninitialized -Wuninitialized -march=native -g3 -O3
  LDFLAGS = -lm -lkeccak
  INCLUDES = -I./include -I$(REFERENCE_IMPL_PATH)/include
  SRCDIR_MAIN_FILE = library
  SRCDIR_LIB_FILE  = $(REFERENCE_IMPL_PATH)/library

# Gathers the names of all C files 
  CSRC_LIB_FILE =  $(wildcard $(SRCDIR_LIB_FILE)/*.c) 
  CSRC_MAIN_FILE = $(wildcard $(SRCDIR_MAIN_FILE)/*.c) 

  BINDIR = bin/

  BINDIR_128SL_DFR64  = $(BINDIR)128SL_DFR64
  BINDIR_128SL_DFRSL  = $(BINDIR)128SL_DFRSL

  BINDIR_192SL_DFR64 = $(BINDIR)192SL_DFR64
  BINDIR_192SL_DFRSL = $(BINDIR)192SL_DFRSL

  BINDIR_256SL_DFR64 = $(BINDIR)256SL_DFR64
  BINDIR_256SL_DFRSL = $(BINDIR)256SL_DFRSL
  

  ALL_BINARIES = testgen/test_128SL_DFR64 \
                 testgen/test_128SL_DFRSL \
                 testgen/test_192SL_DFR64 \
                 testgen/test_192SL_DFRSL \
                 testgen/test_256SL_DFR64 \
                 testgen/test_256SL_DFRSL

.PHONY : all
all: $(BINDIR_128SL_DFR64) $(BINDIR_128SL_DFRSL) \
$(BINDIR_192SL_DFR64) $(BINDIR_192SL_DFRSL) \
$(BINDIR_256SL_DFR64) $(BINDIR_256SL_DFRSL) \
$(ALL_BINARIES)


# Beginning of Security Level 128 
$(BINDIR_128SL_DFR64) $(BINDIR_128SL_DFRSL) :
	mkdir -p $@

COBJS_BINDIR_128SL_DFR64=$(CSRC_LIB_FILE:$(SRCDIR_LIB_FILE)/%.c=$(BINDIR_128SL_DFR64)/%.o)
COBJS_BINDIR_128SL_DFRSL=$(CSRC_LIB_FILE:$(SRCDIR_LIB_FILE)/%.c=$(BINDIR_128SL_DFRSL)/%.o)

COBJS_BINDIR_128SL_DFR64 += $(CSRC_MAIN_FILE:$(SRCDIR_MAIN_FILE)/%.c=$(BINDIR_128SL_DFR64)/%.o)
COBJS_BINDIR_128SL_DFRSL += $(CSRC_MAIN_FILE:$(SRCDIR_MAIN_FILE)/%.c=$(BINDIR_128SL_DFRSL)/%.o)

$(BINDIR_128SL_DFR64)/%.o: $(SRCDIR_MAIN_FILE)/%.c 
	$(CC) $(CFLAGS) $(128SL_CFLAGS) $(N02_CFLAGS) $(DFR_64_CFLAGS) $(INCLUDES) -c $< -o $@
$(BINDIR_128SL_DFRSL)/%.o: $(SRCDIR_MAIN_FILE)/%.c
	$(CC) $(CFLAGS) $(128SL_CFLAGS) $(N02_CFLAGS) $(DFR_SL_CFLAGS) $(INCLUDES) -c $< -o $@


$(BINDIR_128SL_DFR64)/%.o: $(SRCDIR_LIB_FILE)/%.c
	$(CC) $(CFLAGS) $(128SL_CFLAGS) $(N02_CFLAGS) $(DFR_64_CFLAGS) $(INCLUDES) -c $< -o $@
$(BINDIR_128SL_DFRSL)/%.o: $(SRCDIR_LIB_FILE)/%.c 
	$(CC) $(CFLAGS) $(128SL_CFLAGS) $(N02_CFLAGS) $(DFR_SL_CFLAGS) $(INCLUDES) -c $< -o $@
	
	
testgen/test_128SL_DFR64: $(COBJS_BINDIR_128SL_DFR64)
	$(CC) $(COBJS_BINDIR_128SL_DFR64) $(LDFLAGS) -o testgen/test_128SL_DFR64
testgen/test_128SL_DFRSL: $(COBJS_BINDIR_128SL_DFRSL)
	$(CC) $(COBJS_BINDIR_128SL_DFRSL) $(LDFLAGS) -o testgen/test_128SL_DFRSL


######## Security Level 192
$(BINDIR_192SL_DFR64) $(BINDIR_192SL_DFRSL) :
	mkdir -p $@

COBJS_BINDIR_192SL_DFR64=$(CSRC_LIB_FILE:$(SRCDIR_LIB_FILE)/%.c=$(BINDIR_192SL_DFR64)/%.o)
COBJS_BINDIR_192SL_DFRSL=$(CSRC_LIB_FILE:$(SRCDIR_LIB_FILE)/%.c=$(BINDIR_192SL_DFRSL)/%.o)

COBJS_BINDIR_192SL_DFR64 += $(CSRC_MAIN_FILE:$(SRCDIR_MAIN_FILE)/%.c=$(BINDIR_192SL_DFR64)/%.o)
COBJS_BINDIR_192SL_DFRSL += $(CSRC_MAIN_FILE:$(SRCDIR_MAIN_FILE)/%.c=$(BINDIR_192SL_DFRSL)/%.o)

$(BINDIR_192SL_DFR64)/%.o: $(SRCDIR_MAIN_FILE)/%.c 
	$(CC) $(CFLAGS) $(192SL_CFLAGS) $(N02_CFLAGS) $(DFR_64_CFLAGS) $(INCLUDES) -c $< -o $@
$(BINDIR_192SL_DFRSL)/%.o: $(SRCDIR_MAIN_FILE)/%.c
	$(CC) $(CFLAGS) $(192SL_CFLAGS) $(N02_CFLAGS) $(DFR_SL_CFLAGS) $(INCLUDES) -c $< -o $@


$(BINDIR_192SL_DFR64)/%.o: $(SRCDIR_LIB_FILE)/%.c
	$(CC) $(CFLAGS) $(192SL_CFLAGS) $(N02_CFLAGS) $(DFR_64_CFLAGS) $(INCLUDES) -c $< -o $@
$(BINDIR_192SL_DFRSL)/%.o: $(SRCDIR_LIB_FILE)/%.c 
	$(CC) $(CFLAGS) $(192SL_CFLAGS) $(N02_CFLAGS) $(DFR_SL_CFLAGS) $(INCLUDES) -c $< -o $@
	
	
testgen/test_192SL_DFR64: $(COBJS_BINDIR_192SL_DFR64)
	$(CC) $(COBJS_BINDIR_192SL_DFR64) $(LDFLAGS) -o testgen/test_192SL_DFR64
testgen/test_192SL_DFRSL: $(COBJS_BINDIR_192SL_DFRSL)
	$(CC) $(COBJS_BINDIR_192SL_DFRSL) $(LDFLAGS) -o testgen/test_192SL_DFRSL

######## Security Level 256

$(BINDIR_256SL_DFR64) $(BINDIR_256SL_DFRSL) :
	mkdir -p $@

COBJS_BINDIR_256SL_DFR64=$(CSRC_LIB_FILE:$(SRCDIR_LIB_FILE)/%.c=$(BINDIR_256SL_DFR64)/%.o)
COBJS_BINDIR_256SL_DFRSL=$(CSRC_LIB_FILE:$(SRCDIR_LIB_FILE)/%.c=$(BINDIR_256SL_DFRSL)/%.o)

COBJS_BINDIR_256SL_DFR64 += $(CSRC_MAIN_FILE:$(SRCDIR_MAIN_FILE)/%.c=$(BINDIR_256SL_DFR64)/%.o)
COBJS_BINDIR_256SL_DFRSL += $(CSRC_MAIN_FILE:$(SRCDIR_MAIN_FILE)/%.c=$(BINDIR_256SL_DFRSL)/%.o)

$(BINDIR_256SL_DFR64)/%.o: $(SRCDIR_MAIN_FILE)/%.c 
	$(CC) $(CFLAGS) $(256SL_CFLAGS) $(N02_CFLAGS) $(DFR_64_CFLAGS) $(INCLUDES) -c $< -o $@
$(BINDIR_256SL_DFRSL)/%.o: $(SRCDIR_MAIN_FILE)/%.c
	$(CC) $(CFLAGS) $(256SL_CFLAGS) $(N02_CFLAGS) $(DFR_SL_CFLAGS) $(INCLUDES) -c $< -o $@


$(BINDIR_256SL_DFR64)/%.o: $(SRCDIR_LIB_FILE)/%.c
	$(CC) $(CFLAGS) $(256SL_CFLAGS) $(N02_CFLAGS) $(DFR_64_CFLAGS) $(INCLUDES) -c $< -o $@
$(BINDIR_256SL_DFRSL)/%.o: $(SRCDIR_LIB_FILE)/%.c 
	$(CC) $(CFLAGS) $(256SL_CFLAGS) $(N02_CFLAGS) $(DFR_SL_CFLAGS) $(INCLUDES) -c $< -o $@
	
	
testgen/test_256SL_DFR64: $(COBJS_BINDIR_256SL_DFR64)
	$(CC) $(COBJS_BINDIR_256SL_DFR64) $(LDFLAGS) -o testgen/test_256SL_DFR64
testgen/test_256SL_DFRSL: $(COBJS_BINDIR_256SL_DFRSL)
	$(CC) $(COBJS_BINDIR_256SL_DFRSL) $(LDFLAGS) -o testgen/test_256SL_DFRSL
	
.PHONY : clean
clean:
	rm -rf $(BINDIR)* testgen/*
